//
//  CurrentViewModel.swift
//  air
//
//  Created by Naoto Sato on 2024/03/25.
//

import Firebase
import Combine

class ContentViewModel : ObservableObject{ //ViewModelを監視対象にする
    @Published var  userSession : FirebaseAuth.User? //userSessionを監視できるようにする　中身はFirebase.Userオプショナル型
    
    private var cancellabels = Set<AnyCancellable>() //ユニークなデータを保持AnyCancellable配列を保持 複数のサブスクをまとめるサブスク
    init() { //クラスのインスタンスを生成するときに自動で呼び出されるメソッド
        setupSubscribers()
    }
    private func setupSubscribers(){ //イベントを受け取って処理をする側の人間Subscriber
        AuthService.shared.$userSession.sink{ [weak self] userSessionFromAuthService in //userSessionを取り込み　弱参照 .sinkでサブスクライブ開始
            self?.userSession = userSessionFromAuthService
        } .store(in: &cancellabels) //.storeでSet<AnyCancelable>に保持
    }
}
